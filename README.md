# 貯蓄額管理アプリ 設計書

## 1. 概要

### 1.1 サービス概要

本アプリは、GMOあおぞらネット銀行APIを活用し、ユーザーの現在の残高と収入を基に貯蓄可能額を計算し、貯蓄の提案を行うサービスです。必要に応じて、貯蓄用口座への振替を促す機能も提供します。

### 1.2 想定するユーザー

- お金の管理が苦手な人
- 貯蓄を習慣化したい人
- 自分の収支状況を手軽に把握したい人

---

## 2. システム構成

### 2.1 アーキテクチャ

本アプリはサーバーレスアーキテクチャを採用し、AWS Lambdaをバックエンドとして利用します。

### 優先度順の主要コンポーネント

1. **フロントエンド・バックエンド**
    - **フロントエンド**: Next.js（言語：Typescript）
    - **バックエンド**: AWS Lambda（API Gatewayを通じてNext.jsと連携）
    - **利用API**: GMOあおぞらネット銀行API、sunabar
2. **通知（オプション）**
    - **LINE Bot API**を利用し、貯蓄可能額を通知
    - AWS LambdaからLINE通知を送信
3. **データベース（DB不要の場合もあり）**
    - データ保存が不要な場合は、APIから直接データを取得して処理
    - 過去のデータ保存が必要な場合は、Amazon S3にJSONとして保存する方法を検討

### 優先度低めの要素

- **認証**: AWS Cognitoを利用（将来的に追加の可能性）
- **タスクの定期実行**: Amazon EventBridgeを利用（後回し）

---

## 3. 機能仕様

### 3.1 残高・収入の取得 & 貯蓄額の計算

- ユーザーの現在の残高と収入データを取得
- 貯蓄可能額を計算
- Next.jsのUIで結果を表示

### 3.2 振替処理

- 「貯蓄口座へ振替」ボタンを押すと、LambdaがGMO APIを呼び出し振替を実行
- 振替完了後、成功・失敗メッセージを表示

### 3.3 LINE通知（オプション）

- 毎月の通知を送信（スケジュール設定は今後検討）
- ユーザーがLINE上で振替指示可能

---

## 4. API 設計

| メソッド | エンドポイント | 説明 |
| --- | --- | --- |
| GET | `/api/balance` | 現在の残高を取得 |
| GET | `/api/income` | 収入データを取得 |
| POST | `/api/savings/propose` | 貯蓄額を計算し提案する |
| POST | `/api/savings/transfer` | 貯蓄用口座へ振替を実行 |
| POST | `/api/notifications/send` | LINE通知を送信（オプション） |

---

## 5. 開発フロー

1. **APIの調査と試作**
    - sunabar API & GMOあおぞらネット銀行APIの動作確認
    - 必要なAPIをLambdaで実装
2. **Next.jsのUI作成**
    - 残高・収入表示
    - 貯蓄額提案のUI実装
    - 振替処理のフロント側実装
3. **通知機能の開発（オプション）**
    - LINE Bot APIの設定
    - Lambdaからの通知送信機能を実装
4. **デプロイ & 動作確認**
    - Next.jsのデプロイ（Vercel or AWS Amplify）
    - Lambdaのデプロイ & API Gateway設定
    - 実際に振替 & 通知が動作するか確認

---

## 6. 今後の拡張

- 定期的な貯蓄提案の自動化（EventBridgeの活用）
- ユーザー認証機能の追加（AWS Cognito）
- 貯蓄履歴の管理機能（S3 or DynamoDBの利用）
- AIを活用した貯蓄額提案の高度化

---


---

## 7. コーディング規約

### 7.1 一般的な規約

- **命名規則**:
    - ファイル名は小文字のスネークケース（例：`user_profile.ts`）
    - クラス名はパスカルケース（例：`UserProfile`）
    - 変数名はキャメルケース（例：`userProfile`）
- **インデント**:
    - 2スペースでインデント（タブは使用しない）
- **コメント**:
    - `NOTE`、`TODO`、`FIXME`などの意図を持ったコメントを記載する

---

## 8. テスト設計

### 8.1 テストの目的

- 各機能が正しく動作することを確認
- バグや回帰を防ぐ

### 8.2 テスト対象

- API（Lambda関数）
- フロントエンドのUI表示とインタラクション
- データの取得・処理ロジック

### 8.3 使用するテストツール

- **ユニットテスト**: JestまたはVitest
- **UIテスト**: Cypress

---

## 9. エラーハンドリング設計

- APIからのエラーをユーザーに通知
- LambdaのエラーログをCloudWatchに記録
- LINE通知の失敗時にはエラーメッセージをユーザーに通知

---

## 10. まとめ

本アプリは、APIを活用して貯蓄をサポートするシンプルな設計です。DB不要の設計により、シンプルかつコスト効率の良い構成を目指しました。


